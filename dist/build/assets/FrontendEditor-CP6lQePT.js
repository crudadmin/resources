var Observer={MutationObserver:window.MutationObserver||window.WebKitMutationObserver,observeDOM(e,t){if(!(!e||!e.nodeType===1)){var i,s=r=>{i&&clearTimeout(i),i=setTimeout(()=>{t(r)},1)};if(this.MutationObserver){var a=new this.MutationObserver((r,n)=>{s(r)});a.observe(e,{attributes:!0,childList:!0,subtree:!0})}else window.addEventListener&&(e.addEventListener("DOMNodeInserted",s,!1),e.addEventListener("DOMAttrModified",s,!1),e.addEventListener("DOMNodeRemoved",s,!1))}},observeNewElements(){this.observeDOM(document.body,e=>{var t=e.filter(a=>["childList"].indexOf(a.type)>-1).length>0;CAEditor.refresh(t);for(var i=0;i<e.length;i++)for(var s=0;s<e[i].removedNodes.length;s++)e[i].removedNodes[s]._CAPencil&&e[i].removedNodes[s]._CAPencil.remove()})}},Helpers={hasClass(e,t){if(!e||!e.className)return!1;var i=(e.className||"").split(" ");return i.indexOf(t)>-1},addClass(e,t){!e||!e.className||this.hasClass(e,t)===!1&&(e.className+=" "+t)},removeClass(e,t){if(!(!e||!e.className)&&this.hasClass(e,t)===!0){var i=(e.className||"").split(" ");i.splice(i.indexOf(t),1),e.className=i.join(" ")}},htmlspecialchars(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,function(i){return t[i]})},htmlspecialcharsDecode(e){var t={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return e.replace(/(&amp;|&lt;|&gt;|&quot;|&#39;)/g,function(i){return t[i]})}},Navigation={wrapperClassName:"CAE_Navigation",init(){this.addNavigation(),this.bindTranslatesToggle()},addNavigation(){var e=document.createElement("div");let t=__("Režim upravovania"),i=__("Administrácia webu"),s=CAEditor.config.enabled?`<li id="CAE_ToggleState">
                            <label class="CAE_Checkbox CAE_Icons">
                                ${t}
                                <input type="checkbox">
                                <div><div></div></div>
                            </label>
                        </li>`:"";e.className=this.wrapperClassName,e.innerHTML=`
            <div class="CAE_Navigation_button">
                <button></button>
                <div class="CAE_Navigation_navbar">
                    <ul>
                        <li><a class="CAE_Icons" href="${CAEditor.config.requests.admin}" target="_blank">${i} <i class="CAE_Icon--link"></i></a></li>
                        ${s}
                    </ul>
                </div>
            </div>
        `,document.getElementsByTagName("body")[0].appendChild(e)},bindTranslatesToggle(){var e=document.getElementById("CAE_ToggleState");e&&(e.getElementsByTagName("input")[0].checked=CAEditor.config.active,e.addEventListener("change",t=>{CAEditor.toggle()}))}},Pencils={wrapperId:"CAE_Pencils__wrapper",wrapperTooltipNavbar:"CAE_Pencils__tooltip_wrapper",className:"CAE_Pencil",classNameMultiple:"CAE_Pencil--multiple",classNameSaved:"CAE_Pencil--saved",classNameHidden:"CAE_Pencil--hidden",classNameMoving:"CAE_Pencil--moving",classNameAppears:"CAE_Pencil--appears",classNameError:"CAE_Pencil--error",classNameActive:"CAE_Pencil--active",classNameLoading:"CAE_Pencil--loading",classNameIcon:"CAE_Pencil--icon",classNameImage:"CAE_Pencil--image",classNameFile:"CAE_Pencil--file",classNameLinkable:"CAE_Pencil--linkable",classNameEditor:"CAE_Pencil--editor",classNameSubmenu:"CAE_Pencil--subpointers",pointersWrapper:null,init(){this.createPointersWrapper(),this.initHovers(),this.registerClicks(),this.registerResize(),this.registerScroll(),this.buildPencils(),Observer.observeNewElements()},refresh(){this.buildPencils()},createPointersWrapper(){var e=document.createElement("div");e.id=Pencils.wrapperId,document.getElementsByTagName("body")[0].appendChild(e),this.pointersWrapper=e},buildPencils(){for(var e=0;e<CAEditor.matchedElements.length;e++){var t=CAEditor.matchedElements[e];if(t._CAPencil){this.bindPosition(t);continue}t._CAPencil=this.createPencil(t,e),this.bindPosition(t)}},initHovers(){for(var e=document.getElementsByTagName("*"),t=s=>{var a=s.target,r=a.getElementsByTagName("*"),n=[];a._CAPencil&&n.push(a);for(var l=0;l<r.length;l++)r[l]._CAPencil&&n.push(r[l]);for(var l=0;l<n.length;l++)this.observePencilMovement(n[l])},i=0;i<e.length;i++)e[i].addEventListener("mouseenter",t),e[i].addEventListener("mouseleave",t)},observePencilMovement(e){var t=null,i=()=>{var s,a;if(e.nodeName=="#text"){var r=document.createRange();r.selectNodeContents(e),s=r.getClientRects()[0],a=e.parentElement?getComputedStyle(e.parentElement):{}}else s=e.getBoundingClientRect(),a=getComputedStyle(e);var n=s?[s.x,s.y,a.opacity,a.visibility].join("-"):null;s&&t!=n?(Pencils.bindPosition(e),t=n,setTimeout(i,100)):Helpers.removeClass(e._CAPencil,this.classNameMoving)};Helpers.addClass(e._CAPencil,this.classNameMoving),i()},placeCaretAtEnd(e){if(e.focus(),typeof window.getSelection<"u"&&typeof document.createRange<"u"){var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var i=window.getSelection();i.removeAllRanges(),i.addRange(t)}else if(typeof document.body.createTextRange<"u"){var s=document.body.createTextRange();s.moveToElementText(e),s.collapse(!1),s.select()}},registerClicks(){document.body.addEventListener("click",e=>{for(var t=e.pageX,i=e.pageY,s=document.getElementsByTagName("*"),a=[],r=0;r<s.length;r++){var n=s[r].getBoundingClientRect(),l={top:n.top+window.scrollY,left:n.left+window.scrollX},o={x:[l.left,l.left+s[r].offsetWidth],y:[l.top,l.top+s[r].offsetHeight]};t>=o.x[0]&&t<=o.x[1]&&i>=o.y[0]&&i<=o.y[1]&&a.push(s[r])}for(var r=0;r<a.length;r++)if(Helpers.hasClass(a[r],Pencils.className)){Pencils.onClick(a[r]),e.preventDefault(),this.removeAdditionalPointers(null,e.originalPointer||a[r]);return}return this.removeAdditionalPointers(),!1}),document.body.addEventListener("mouseup",e=>{var t=CAEditor.allMatchedElements();t.forEach(i=>{this.observePencilMovement(i)})})},registerResize(){var e;window.addEventListener("resize",()=>{e&&clearTimeout(e),e=setTimeout(this.repaintPencils,100)})},registerScroll(){var e;window.addEventListener("scroll",()=>{e&&clearTimeout(e),e=setTimeout(this.repaintPencils,30)})},onClick(e){var t=e._CAElement,i=Object.keys(t.getPointerSettings()),s=t.getPointerSetting("onPointerClick",e.pointerType||(i.length==1?i[0]:null));if(Helpers.removeClass(e,Pencils.classNameError),s)s(t,e);else if(i.length>1){if(this.removeAdditionalPointers(e))return;Helpers.addClass(e,Pencils.classNameSubmenu);for(var a=10,r=parseInt(e.offsetWidth/2)+a,n=0;n<i.length;n++){let l=this.createPencil(t,null,i[n]);e.additionalPointers.push(l),l.originalPointer=e,l.leftOffset=l.offsetWidth/2+r,l.style.left=e.style.left,l.pointerType=i[n],this.bindPosition(t,l),r+=l.offsetWidth+a}}},removeAdditionalPointers(e,t){var i=!1,s=[];if(e)s.push(e);else for(var a=0;a<CAEditor.matchedElements.length;a++){let n=CAEditor.matchedElements[a]._CAPencil.additionalPointers;if(n&&n.length>0&&CAEditor.matchedElements[a]._CAPencil!==t){s.push(CAEditor.matchedElements[a]._CAPencil);break}}for(var r=0;r<s.length;r++){let n=s[r];if(n.additionalPointers&&n.additionalPointers.length>0)for(var a=0;a<n.additionalPointers.length;a++)n.additionalPointers[a].style.left=n.style.left,setTimeout((function(){this.remove()}).bind(n.additionalPointers[a]),200),i=!0;n.additionalPointers=[],Helpers.removeClass(n,Pencils.classNameSubmenu)}return i},repaintPencils(){for(var e=0;e<CAEditor.matchedElements.length;e++)Pencils.bindPosition(CAEditor.matchedElements[e])},createPencil(e,t,i){var s=Object.keys(e.getPointerSettings()),a=document.createElement("div");a.setAttribute("data-key",t),a.className=Pencils.className+(s.length>1&&!i?" "+Pencils.classNameMultiple:""),a._CAElement=e;var r=e.getAllPointerSetting("onPointerCreate",i);return r.forEach(n=>{n&&n(a,e)}),this.pointersWrapper.appendChild(a),a},bindPosition(e,t){t=t||e._CAPencil;var i=20,s=20;if(t!==void 0){var a=!1,r=!1,n=e.getBoundingClientRect?e.getBoundingClientRect():null,l=n?n.x:null,o=n?n.y:null,c=e.nodeName=="#text"?e:e.childNodes.length==1?e.firstChild:null,d;if(c){var f=document.createRange();f.selectNodeContents(c),d=f.getClientRects()}if(d&&d.length>0)l=d[0].x+d[0].width,o=d[0].y;else if(n){var u=getComputedStyle(e),v=u["text-align"],E=parseFloat(u["padding-left"].replace("px","")),m=parseFloat(u["padding-right"].replace("px","")),P=parseFloat(u["padding-top"].replace("px",""));if(l+=E,o+=P,e.nodeName==="IMG"){l=l+e.getBoundingClientRect().width;var h=window.outerWidth,C=h+s;l>=h&&l<=C&&(l=h-s)}else l-=s,v=="center"&&(l+=(e.offsetWidth-E-m)/2)}var p=this.isPositionFixed(e);if(a||(r=!o||!l||o==0||l==0,a=r||this.isHiddenElement(e)),t.leftOffset&&(l+=t.leftOffset),t.style.position=p?"fixed":"absolute",t.style.left=(p?0:window.scrollX)+l+"px",t.style.top=(p?0:window.scrollY)+o-i+"px",t.style.display&&t.style.display!="none"&&a&&!r){var b=e.getAllPointerSetting("onPointerHide");b.forEach(A=>{A(e,t)}),t.disappearTimaout&&clearTimeout(t.disappearTimaout),t.disappearTimaout=setTimeout(()=>{t.style.display=a?"none":"block"},750)}else t.style.display=a?"none":"block",a||clearTimeout(t.disappearTimaout);if(this.setPencilZindex(e,t),t.additionalPointers&&t.additionalPointers.length)for(var g=0;g<t.additionalPointers.length;g++)this.bindPosition(e,t.additionalPointers[g])}},isPositionFixed(e,t){for(var i=!1;e.parentElement;){var s=e.nodeType==1?window.document.defaultView.getComputedStyle(e).position:null;if(s=="fixed"){i=!0;break}e=e.parentElement}return i},isHiddenElement(e,t){for(var i=!1;e.parentElement;){var s=e.nodeType==1?window.document.defaultView.getComputedStyle(e):null;if(s&&(s.opacity<.2||s.visibility=="hidden")){i=!0,e.observer||(Observer.observeDOM(e,()=>{this.observePencilMovement(e)}),e.observer=!0);break}e=e.parentElement}return i},setPencilZindex(e,t){var i=e,s="auto";do{var a=i.nodeType==1?parseInt(window.document.defaultView.getComputedStyle(i).zIndex):NaN;isNaN(a)||a<0||(s=a)}while(i=i.parentElement);t.style.zIndex=s},hideAllPencils(){for(var e=0;e<CAEditor.matchedElements.length;e++){var t=CAEditor.matchedElements[e]._CAPencil;t&&Helpers.addClass(t,Pencils.classNameHidden)}},showAllPencils(){for(var e=0;e<CAEditor.matchedElements.length;e++){var t=CAEditor.matchedElements[e]._CAPencil;t&&(Helpers.removeClass(t,Pencils.classNameHidden),this.bindPosition(CAEditor.matchedElements[e]))}}},Translatable={allTranslates:null,rawTranslates:null,translatedTree:[],duplicates:[],maxTranslateLength:0,boot(e,t){typeof e=="object"&&e.translates&&t==!0&&(CAEditor.config.translatable=!0),CAEditor.config.translatable!==!1&&(this.allTranslates=e.translates.messages?e.translates.messages[""]:{},this.rawTranslates=e.rawTranslates,this.getTranslationsTree(),this.getTranslatableElements())},registerTranslatableElement(e,t){var i=!1;if(e.hasPointer&&e.hasPointer.indexOf("translatable")>-1||e._isInEditorElement||(i=this.isInEditorElement(e))){i&&(e._isInEditorElement=!0);return}CAEditor.pushPointerElement(e,"translatable",{originalTranslate:this.translatedTree[t],onPointerCreate:this.events.onPointerCreate.bind(this),onPointerClick:this.events.onPointerClick.bind(this),onPointerHide:this.events.onPointerHide.bind(this)})},getTranslationsTree(){var e=[];for(var t in this.allTranslates){var i=this.domPreparer.prepareTranslateHTML(this.allTranslates[t][0]||t);e.length>0&&i.indexOf(e)===-1||(i&&i.indexOf("je fiktívny text")>-1&&console.log(i),i in this.translatedTree&&this.duplicates.push(i),this.translatedTree[i]=t,i.length>this.maxTranslateLength&&(this.maxTranslateLength=i.length))}},domPreparer:{prepared:{},prepareTranslateHTML(e,t){if(e in this.prepared)return this.prepared[e];var i=document.createElement("div");return i.innerHTML=e,this.modifyElements(i),this.prepared[e]=i.innerHTML},modifyElements(e){if(e.childNodes)for(var t=0;t<e.childNodes.length;t++){let i=e.childNodes[t];this.sortAttributes(i),i.childNodes&&i.childNodes.length>0&&this.modifyElements(i)}},sortAttributes(e){let t=[];if(e.attributes&&e.attributes.length>0){for(let i=0;i<e.attributes.length;i++)t.push({name:e.attributes[i].nodeName,value:e.attributes[i].nodeValue});t=t.sort((i,s)=>i.name>s.name?1:-1),t.forEach(i=>{e.removeAttribute(i.name)}),t.forEach(i=>{i=this.updateAttribute(i),e.setAttribute(i.name,i.value)})}},updateAttribute(e){if(e.name=="style"){let t=e.value.replace(/\:/g,": ").replace(/\s\s/g," ");t&&t.substr(-1)!=";"&&(t+=";"),e.value=t}return e}},getTranslatableElements(){for(var e=document.querySelectorAll("*"),t=0;t<e.length;t++){var i=this.nodeValue(e[t]);if(!((i||"").length>this.maxTranslateLength*1.5))if(this.translatedTree[i]!==void 0)this.registerTranslatableElement(e[t],i);else for(var s=0;s<e[t].childNodes.length;s++){var a=e[t].childNodes[s];a.nodeName==="#text"&&(i=this.nodeValue(a),e[t].childNodes.length===1&&(a=a.parentElement),this.translatedTree[i]!==void 0&&this.registerTranslatableElement(a,i))}}},nodeValue(e){var t=e.nodeName=="#text"?e.data:e.innerHTML,t=t||"";return this.domPreparer.prepareTranslateHTML(t,e).trim()},isInEditorElement(e){if(e){if(e.hasPointer&&e.hasPointer.indexOf("translatable")>-1||e.nodeName!="#text"&&e.getAttribute("data-crudadmin-editor")==="")return!0;if(e.parentElement)return this.isInEditorElement(e.parentElement)}return!1},updateTranslation(e){var t={changes:{}},i=this.nodeValue(e);i.substr(-6)=="&nbsp;"&&(i=i.substr(0,-6)),Editor.hasAllowedFormation(e)===!1&&(i=Helpers.htmlspecialcharsDecode(i)),t.changes[e.getPointerSetting("originalTranslate","translatable")]=i,this._ajaxSend&&clearTimeout(this._ajaxSend),Helpers.removeClass(e._CAPencil,Pencils.classNameError),this._ajaxSend=setTimeout(()=>{var s=CAEditor.config.requests.updateText;CAEditor.ajax.post(s,t,{success(a){Helpers.addClass(e._CAPencil,Pencils.classNameSaved)},error(a){Helpers.addClass(e._CAPencil,Pencils.classNameError)}}),this.updateSameTranslationElements(e)},1e3)},updateSameTranslationElements(e){for(var t=0;t<CAEditor.matchedElements.length;t++)CAEditor.matchedElements[t].getPointerSetting("originalTranslate","translatable")==e.getPointerSetting("originalTranslate","translatable")&&CAEditor.matchedElements[t]!=e&&(CAEditor.matchedElements[t].innerHTML=e.innerHTML)},isInvisibleElement(e){e.nodeName=="#text"&&(e=e.parentElement);var t=window.getComputedStyle(e),i=parseInt(t.opacity);return i<=.5||t.visibility=="hidden"||t.fontSize==0},openAlertModal(e,t){var i=prompt(CATranslates.texts.update,t);i!=null&&(e.nodeName=="#text"?e.data=i:e.innerHTML=i,CAEditor.pencils.repaintPencils(),this.updateTranslation(e))},isStaticEditor(e){return e.nodeName!="#text"&&e.getAttribute("data-crudadmin-static-editor")===""},events:{onPointerCreate(e,t){this.isStaticEditor(t)&&(Helpers.addClass(e,Pencils.classNameIcon),Helpers.addClass(e,Pencils.classNameEditor)),e.setAttribute("data-translate",t.getPointerSetting("originalTranslate","translatable"))},onPointerClick(e,t){var i=this.nodeValue(e);if(this.duplicates.indexOf(i)>-1){alert(CATranslates.texts.cannotUpdate);return}this.isInvisibleElement(e)?this.openAlertModal(e,i):this.isStaticEditor(e)?Editor.makeInlineCKEditor(e,()=>{Translatable.updateTranslation(e)}):Editor.makeEditableNode(e,i),Pencils.removeAdditionalPointers(e._CAPencil)},onPointerHide(e,t){if(e.isContentEditable===!0){var i=this.nodeValue(e);Editor.turnOffEditor(e),this.openAlertModal(e,i)}}}},Editor={inlineClass:"CAE__InlineWrapper",ckEditorBooted:!1,hasAllowedFormation(e){return CAEditor.translatable.rawTranslates.indexOf(e.getPointerSetting("originalTranslate","translatable"))>-1},isDisabledFormationActionEvent(e,t){if(this.hasAllowedFormation(e.target))return e.keyCode==13&&(document.execCommand("insertHTML",!1,"<br>"),e.preventDefault()),!0;var i=!0;if(e.keyCode==13)return this.turnOffEditor(t),!1;if(e.ctrlKey||e.metaKey)switch(e.keyCode){case 66:case 98:i=!1;break;case 73:case 105:i=!1;break;case 85:case 117:i=!1;break}return i},allowFormatingByTranslateType(e){e.addEventListener("keydown",t=>{this.isDisabledFormationActionEvent(t,e)===!1&&t.preventDefault()})},fixEmptyStrings(e){e.addEventListener("keydown",function(t){setTimeout(function(){t.target.innerHTML.length==7&&t.target.innerHTML.substr(-6)=="&nbsp;"&&(t.target.innerHTML=t.target.innerHTML.substr(0,t.target.innerHTML.length-6),CAEditor.pencils.placeCaretAtEnd(t.target)),t.target.innerHTML===""&&(t.target.innerHTML="&nbsp;")},1)})},disableRichPaste(e){e.addEventListener("paste",t=>{t.preventDefault();var i=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,i)})},enableAutoSave(e){e.addEventListener("keyup",function(t){var i=e._CAPencil;Helpers.removeClass(i,CAEditor.pencils.classNameSaved),CAEditor.pencils.repaintPencils(),Translatable.updateTranslation(e)})},makeEditableNode(e,t){if(e.nodeName=="#text"&&e.getPointerSetting("originalTranslate","translatable")){var i=document.createElement("div");i.className=this.inlineClass;let s=e;e.parentNode.insertBefore(i,e),i.appendChild(e),e=i,e._CAPencil=s._CAPencil,e._CAPencil._CAElement=e,CAEditor.registerPointerProperties(e,"translatable",s.getPointerSettings().translatable)}e.innerHTML=t,e.contentEditable=!0,CAEditor.pencils.placeCaretAtEnd(e),Helpers.addClass(e._CAPencil,Pencils.classNameActive),!e.hasBindedEvents&&(e.hasBindedEvents=!0,this.allowFormatingByTranslateType(e),this.fixEmptyStrings(e),this.disableRichPaste(e),this.enableAutoSave(e),this.onUnblur(e),this.onClick(e))},onUnblur(e){e.addEventListener("blur",t=>{this.turnOffEditor(e)})},onClick(e){e.addEventListener("click",t=>{t.target.isContentEditable==!0&&t.preventDefault()})},turnOffAllEditors(){for(var e=0;e<CAEditor.matchedElements.length;e++){var t=CAEditor.matchedElements[e];this.turnOffEditor(t)}},turnOffEditor(e){e.isContentEditable==!0&&(e.contentEditable=!1,Helpers.removeClass(e._CAPencil,Pencils.classNameActive))},bootCkEditor(e){if(this.ckEditorBooted===!0)return e();var t=document.createElement("script");t.src=CAEditorConfig.ckeditor_path,t.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(t),t.onload=()=>{this.ckEditorBooted=!0,e()}},makeInlineCKEditor(e,t){this.bootCkEditor(()=>{if(e.hasBootedCKEditor==!0){e.contentEditable=!0,e.focus();return}e.contentEditable=!0,CKEDITOR.inline(e,{startupFocus:!0,on:{change(i){Pencils.refresh(),t(i)}}}),e.hasBootedCKEditor=!0,Helpers.addClass(e._CAPencil,Pencils.classNameActive)})}},Ajax={post(e,t,i,s){var a=new XMLHttpRequest;a.open("POST",e,!0),a.setRequestHeader("X-CSRF-TOKEN",CAEditor.config.token),a.setRequestHeader("Accept","application/json"),t instanceof FormData?a.send(t):(a.setRequestHeader("Content-type","application/json"),a.send(JSON.stringify(t))),a.onreadystatechange=()=>{if(i&&a.readyState==4&&a.status==200){if(a.getResponseHeader("Content-Type")=="application/json")try{a.responseJSON=JSON.parse(a.response)}catch(r){console.error(r)}typeof i=="function"&&i(a),typeof i=="object"&&i.success&&i.success(a)}else a.readyState==4&&(typeof s=="function"&&s(a),typeof i=="object"&&i.error&&i.error(a))}}},Uploadable={queryKey:"ca_table_name",sizesKey:"sizes",classNameUploadableWrapper:"CAE_Uploadable_wrapper",uploadWrapper:null,imageElement:null,boot(){CAEditor.config.uploadable!==!1&&(this.registerAllImages(),this.buildUploadWrapper(),this.bindEvents())},isUploadableImage(e){return e&&(e.indexOf("?"+this.queryKey)>-1||e.indexOf("&"+this.queryKey)>-1)},registerAllImages(){for(var e=[...document.getElementsByTagName("img"),...document.getElementsByTagName("a")],t=document.getElementsByTagName("*"),i=0;i<e.length;i++)this.isUploadableImage(e[i].src)&&this.registerImageElement(e[i],e[i].src),this.isUploadableImage(e[i].href)&&this.registerImageElement(e[i],e[i].href,!0);for(var i=0;i<t.length;i++){let a=t[i];if(!a.getAttribute("style")||!a.style.backgroundImage)continue;let r=a.style.backgroundImage.replace(/^url\(["']?/,"").replace(/["']?\)$/,"");this.isUploadableImage(r)&&this.registerImageElement(a,r)}},getQueryPart(e,t){var i=e.split(t+"=");return i.length>1?decodeURIComponent(i[1].split("&")[0]):null},registerImageElement(e,t,i){CAEditor.pushPointerElement(e,"uploadable",{defaultUrl:t,onPointerCreate:this.events.onPointerCreate.bind(this),onPointerClick:this.events.onPointerClick.bind(this),isFileUpload:!!i})},buildUploadWrapper(){if(!this.uploadWrapper){var e=document.createElement("input");e.type="file",e.className=this.classNameUploadableWrapper,document.getElementsByTagName("body")[0].appendChild(e),this.uploadWrapper=e}},buildRequest(e){var t=new FormData,i=Uploadable.imageElement.getPointerSetting("defaultUrl","uploadable"),s=this.getQueryPart(i,"sizes");return t.append("_table",this.getQueryPart(i,this.queryKey)),t.append("_key",this.getQueryPart(i,"ca_field_name")),t.append("_id",this.getQueryPart(i,"ca_row_id")),t.append("_hash",this.getQueryPart(i,"ca_hash")),t.append("_is_image",Uploadable.imageElement.getPointerSetting("isFileUpload","uploadable")?0:1),t.append(this.getQueryPart(i,"ca_field_name"),e.target.files[0]),s&&t.append("_sizes",s),t},bindEvents(){this.uploadWrapper.addEventListener("change",e=>{e.target.files.length==0&&(Uploadable.imageElement=null);var t=Uploadable.imageElement._CAPencil;Helpers.removeClass(t,Pencils.classNameSaved),Helpers.addClass(t,Pencils.classNameLoading),Uploadable.imageElement.style.opacity=.5;var i=this.buildRequest(e),s=r=>{Helpers.removeClass(r._CAPencil,Pencils.classNameLoading),r.style.opacity=1},a=r=>{var n=Uploadable.imageElement.getPointerSetting("defaultUrl","uploadable");Helpers.addClass(t,Pencils.classNameError),s(Uploadable.imageElement),Uploadable.imageElement=null;try{var l=JSON.parse(r.response),o=l.errors[this.getQueryPart(n,"ca_field_name")];o&&o.length>0&&alert(o)}catch(c){console.error(c)}};Ajax.post(CAEditor.config.requests.updateImage,i,{success:r=>{if(!r.responseJSON){a(r);return}this.updateImagesWithSameSrc(r,Uploadable.imageElement),Helpers.addClass(t,Pencils.classNameSaved),Uploadable.imageElement.nodeName=="IMG"?Uploadable.imageElement.onload=n=>{s(n.target),CAEditor.pencils.repaintPencils()}:s(Uploadable.imageElement),Uploadable.imageElement=null},error:a})})},updateImagesWithSameSrc(e,t){CAEditor.allMatchedElements("uploadable").forEach(i=>{i.getPointerSetting("defaultUrl","uploadable")==t.getPointerSetting("defaultUrl","uploadable")&&(i.nodeName=="IMG"?(i.src=e.responseJSON.url,i.srcset&&(i.srcset=e.responseJSON.url+" 1x")):i.style.backgroundImage?i.style.backgroundImage='url("'+e.responseJSON.url+'")':i.href&&(i.href=e.responseJSON.url),Pencils.removeAdditionalPointers(i._CAPencil))})},events:{onPointerCreate(e,t){let i=t.getPointerSetting("isFileUpload","uploadable");Helpers.addClass(e,Pencils.classNameIcon),Helpers.addClass(e,i?Pencils.classNameFile:Pencils.classNameImage)},onPointerClick(e,t){var i=document.createEvent("MouseEvents");i.initEvent("click",!1,!0),Uploadable.imageElement=e,this.uploadWrapper.dispatchEvent(i)}}},Linkable={querySeparator:"#ca-linkable=",boot(){CAEditor.config.Linkable!==!1&&this.registerAllLinks()},isLinkableUrl(e){var t=e.split(this.querySeparator);return t.length>1},registerAllLinks(){for(var e=document.getElementsByTagName("a"),t=0;t<e.length;t++){var i=e[t].href;this.isLinkableUrl(i)&&this.registerLinkableElement(e[t],i)}},registerLinkableElement(e,t,i){var s=t.split(this.querySeparator);CAEditor.pushPointerElement(e,"linkable",{defaultUrl:t,rowId:s[s.length-1],onPointerCreate:this.events.onPointerCreate.bind(this),onPointerClick:this.events.onPointerClick.bind(this)})},updateLink(e,t){var i={id:e.getPointerSetting("rowId","linkable"),language:CAEditor.config.language,url:t};CAEditor.ajax.post(CAEditor.config.requests.updateLink,i,{success(s){Helpers.addClass(e._CAPencil,Pencils.classNameSaved),Pencils.removeAdditionalPointers(e._CAPencil),e.href=s.responseText},error(s){Helpers.addClass(e._CAPencil,Pencils.classNameError)}})},events:{onPointerCreate(e,t){Helpers.addClass(e,Pencils.classNameIcon),Helpers.addClass(e,Pencils.classNameLinkable)},onPointerClick(e,t){var i=document.createEvent("MouseEvents");i.initEvent("click",!1,!0);var s=e.href.split(this.querySeparator),a=s[0],r=prompt(CATranslates.texts.updateLink,a);r!==null&&Linkable.updateLink(e,r)}}},Editable={boot(){this.registerAllEditors()},isEditableElement(e){return e.getAttribute("data-crudadmin-editor")==""&&parseInt(e.getAttribute("data-id"))>0},registerAllEditors(){for(var e=document.getElementsByTagName("*"),t=0;t<e.length;t++)this.isEditableElement(e[t])&&this.registerEditableElement(e[t])},registerEditableElement(e,t,i){CAEditor.pushPointerElement(e,"editable",{onPointerCreate:this.events.onPointerCreate.bind(this),onPointerClick:this.events.onPointerClick.bind(this)})},updateContent(e,t){var i={language:CAEditor.config.language,model:e.getAttribute("data-model"),key:e.getAttribute("data-key"),id:e.getAttribute("data-id"),hash:e.getAttribute("data-hash"),content:t};CAEditor.ajax.post(CAEditor.config.requests.updateContent,i,{success(s){Helpers.addClass(e._CAPencil,Pencils.classNameSaved),Pencils.removeAdditionalPointers(e._CAPencil)},error(s){Helpers.addClass(e._CAPencil,Pencils.classNameError)}})},events:{onPointerCreate(e,t){Helpers.addClass(e,Pencils.classNameIcon),Helpers.addClass(e,Pencils.classNameEditor)},onPointerClick(e,t){var i;Editor.makeInlineCKEditor(e,s=>{i&&clearTimeout(i),i=setTimeout(()=>{Editable.updateContent(e,s.editor.getData())},1e3)})}}};(function(){window.CAEditor={state:!1,config:window.CAEditorConfig,translatable:Translatable,uploadable:Uploadable,linkable:Linkable,editable:Editable,matchedElements:[],pencils:Pencils,init(e){Navigation.init(),CAEditor.config.active!==!1&&this.boot(e)},boot(e,t){Translatable.boot(e,t),Uploadable.boot(),Linkable.boot(),Editable.boot(),this.pencils.init(),this.state=!0},enable(){this.config.active===!0?(Pencils.showAllPencils(),this.state=!0,this.ajax.post(this.config.requests.changeState,{state:!0})):(this.config.active=!0,this.ajax.post(this.config.requests.changeState,{state:!0,response:!0},response=>{var JSONObject=eval(response.response);this.boot(JSONObject,!0)}))},toggle(){this.state===!1?this.enable():this.destroy()},destroy(){Pencils.hideAllPencils(),Editor.turnOffAllEditors(),this.state=!1,this.ajax.post(this.config.requests.changeState,{state:!1})},refresh(e){e===!0&&(this.isRefreshedDom=!0),this.refreshingState&&clearTimeout(this.refreshingState),this.refreshingState=setTimeout(()=>{this.isRefreshedDom===!0&&(Translatable.getTranslatableElements(),this.isRefreshedDom=!1),this.pencils.refresh()},1e3)},registerPointerProperties(e,t,i){e.hasPointer||(e.hasPointer=[]),e._pointerSettings||(e._pointerSettings={}),e.getPointerSetting||(e.getPointerSetting=function(s,a){if(!(!this._pointerSettings||!this._pointerSettings[a]))return this._pointerSettings[a][s]}),e.getAllPointerSetting||(e.getAllPointerSetting=function(s,a){var r=[];for(var n in this._pointerSettings)s in this._pointerSettings[n]&&(!a||a==n)&&r.push(this._pointerSettings[n][s]);return r}),e.getPointerSettings||(e.getPointerSettings=function(){return this._pointerSettings}),e.setPointerSetting||(e.setPointerSetting=function(s,a,r){this._pointerSettings[r][s]=a}),e.setPointerSettings||(e.setPointerSettings=function(s,a){for(var r in a)e.setPointerSetting(r,a[r],s)}),e.hasPointer.push(t),e._pointerSettings[t]={},i&&e.setPointerSettings(t,i)},pushPointerElement(e,t,i){e.hasPointer&&e.hasPointer.indexOf(t)>-1||(this.registerPointerProperties(e,t,i),this.matchedElements.indexOf(e)===-1&&this.matchedElements.push(e))},ajax:Ajax,allMatchedElements(e){if(!e)return this.matchedElements;for(var t=[],i=0;i<this.matchedElements.length;i++)e in this.matchedElements[i].getPointerSettings()&&t.push(this.matchedElements[i]);return t}},window.addEventListener("load",()=>{CAEditor.init(window.CATranslates)})})();
